<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BW - Bromyard Utility Suite</title>
    
    <link rel="icon" type="image/png" href="bw-logo.png">
    <link rel="stylesheet" href="style.css">
    <link rel="apple-touch-icon" href="bw-logo.png">
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        /* Reduced global padding to push content up */
        .container { padding: 10px 20px; }
        
        .section-title { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; color: #64748b; margin: 15px 0 8px; text-align: left; }
        
        /* Smaller Header for more screen space */
        .profile { margin-bottom: 10px; }
        .profile img { width: 55px; margin-bottom: 5px; }
        .profile h1 { font-size: 1.4rem; margin-bottom: 2px; }
        .profile p { 
            font-size: 1.1rem; 
            font-weight: 800; 
            color: #10b981; 
            text-transform: uppercase; 
            letter-spacing: 0.12em;
            margin-bottom: 5px;
        }

        /* Compact Link Cards */
        .link-card { padding: 14px; margin-bottom: 8px; font-size: 0.95rem; }

        /* Compact Expanding Notepad */
        .btn-note-toggle { 
            background: #1e293b; border: 1px solid #334155; color: #f1f5f9; 
            font-size: 0.9rem; cursor: pointer; width: 100%; padding: 14px; 
            border-radius: 10px; font-weight: 600; display: flex; justify-content: space-between; 
            align-items: center; transition: 0.2s; 
        }

        .note-content.open { max-height: 200px; padding: 12px; }
        #depotNotes { height: 100px; font-size: 0.85rem; }

        /* Machinery Scanner Button */
        #reader { width: 100%; border-radius: 12px; overflow: hidden; display: none; margin-bottom: 10px; border: 1px solid #334155; background: #000; }
        .btn-scanner { background: #1e293b; border: 1px solid #334155; color: white; padding: 14px; border-radius: 10px; font-weight: 600; margin-bottom: 8px; cursor: pointer; font-size: 0.95rem; width: 100%; }

        /* H&S and Emergency Buttons */
        .btn-first-aid { background: #008b45; border-color: #006400; color: white; font-weight: bold; }
        .btn-emergency { background: #000; color: #ef4444; border: 2px solid #ef4444 !important; font-weight: 800; margin-top: 5px; }
        .w3w-box { background: #e11f26; color: white; padding: 4px 8px; border-radius: 4px; font-family: monospace; font-size: 0.85rem; display: inline-block; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <header class="profile">
            <img src="bw-logo.png" class="avatar" alt="British Wool Logo">
            <h1>Bromyard Depot</h1>
            <p>Utility Suite</p>
        </header>

        <main class="links">
            <div class="section-title">Data Processing</div>
            <a href="wool-processor/index.html" class="link-card">Wool Intake Receipt Processor</a>
            <a href="bale-extractor/index.html" class="link-card">Bale Packing Sheet Extractor</a>
            <a href="bale-tracker/index.html" class="link-card">Bale Transportation Tracker</a>

            <div class="note-wrapper" style="margin-top: 10px;">
                <button class="btn-note-toggle" id="noteToggle">
                    <span>üìù Depot Notepad</span>
                    <span id="toggleIcon">‚ñº</span>
                </button>
                <div class="note-content" id="noteContent">
                    <textarea id="depotNotes" placeholder="Record shift notes here..."></textarea>
                    <div class="note-footer" style="display:flex; justify-content:space-between; align-items:center; margin-top:5px;">
                        <span id="saveStatus" style="font-size:0.6rem; color:#64748b;">Auto-saved to device</span>
                        <button onclick="shareNote()" style="background:none; border:none; color:#10b981; font-weight:bold; font-size:0.7rem; cursor:pointer;">üì§ SHARE</button>
                    </div>
                </div>
            </div>

            <div class="section-title">Machinery & Assets</div>
            <button id="scanBtn" class="btn-scanner"><span>üì∑</span> Scan Machine QR Code</button>
            <div id="reader"></div>

            <div class="section-title">Health & Safety</div>
            <a href="#" class="link-card btn-first-aid">First Aid Kit Log</a>
            <button class="link-card btn-emergency" style="width: 100%; cursor: pointer;" onclick="showEmergencyContacts()">EMERGENCY CONTACTS</button>
        </main>
        
        <footer class="socials" style="margin-top:15px;">
            <a href="print-qr.html" style="color: #10b981; font-size: 0.75rem; text-decoration: none;">Print QR Poster</a>
            <div class="version-tag" style="font-size: 0.6rem; color: #475569; margin-top: 5px;">Build v1.2.1-Bromyard</div>
        </footer>
    </div>

    <script>
        const depotLocation = "///intent.reeling.mops"; 
        const depotContacts = [
            { role: "Depot Manager", name: "Gareth Bowdler", phone: "07929 667272" },
            { role: "First Aider", name: "Gareth Bowdler", phone: "07929 667272" },
            { role: "Operations", name: "Billy Hewitson", phone: "07xxx xxxxxx" }
        ];

        // Notepad Logic
        const noteToggle = document.getElementById('noteToggle');
        const noteContent = document.getElementById('noteContent');
        const noteArea = document.getElementById('depotNotes');
        const saveStatus = document.getElementById('saveStatus');

        noteToggle.onclick = () => {
            const isOpen = noteContent.classList.toggle('open');
            document.getElementById('toggleIcon').innerText = isOpen ? '‚ñ≤' : '‚ñº';
            if(isOpen) noteArea.focus();
        };

        noteArea.value = localStorage.getItem('bromyard_notes') || "";
        noteArea.addEventListener('input', () => {
            localStorage.setItem('bromyard_notes', noteArea.value);
            saveStatus.innerText = "Saving...";
            setTimeout(() => { saveStatus.innerText = "Auto-saved to device"; }, 500);
        });

        async function shareNote() {
            if (!noteArea.value) return alert("Note is empty!");
            if (navigator.share) {
                try { await navigator.share({ title: 'Bromyard Depot Note', text: noteArea.value }); } catch (e) {}
            } else {
                navigator.clipboard.writeText(noteArea.value);
                alert("Note copied to clipboard!");
            }
        }

        // Emergency Contacts Logic
        function showEmergencyContacts() {
            let listHtml = depotContacts.map(c => `
                <div style="margin-bottom: 10px; border-bottom: 1px solid #334155; padding-bottom: 6px;">
                    <strong style="color: #10b981; font-size: 0.65rem; text-transform: uppercase;">${c.role}</strong>
                    <div style="font-size: 1rem; font-weight: bold; color: #fff;">${c.name}</div>
                    <a href="tel:${c.phone.replace(/\s/g, '')}" style="color: #3b82f6; text-decoration: none; font-size: 1rem;">${c.phone}</a>
                </div>`).join('');

            const modal = `
                <div id="cModal" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:10000; display:flex; justify-content:center; align-items:center; padding:15px;">
                    <div style="background:#1e293b; width:100%; max-width:320px; padding:20px; border-radius:16px; border:1px solid #ef4444;">
                        <h2 style="margin-top:0; color:#ef4444; font-size:1.2rem;">Emergency Details</h2>
                        <div style="margin-bottom: 15px; padding: 8px; background: rgba(225, 31, 38, 0.1); border-radius: 8px;">
                            <strong style="color: #fff; font-size: 0.65rem; text-transform: uppercase;">Location w3w:</strong><br>
                            <div class="w3w-box">${depotLocation}</div>
                        </div>
                        ${listHtml}
                        <button onclick="document.getElementById('cModal').remove()" style="width:100%; padding:10px; background:#ef4444; color:white; border:none; border-radius:8px; font-weight:bold; cursor:pointer; margin-top:5px;">CLOSE</button>
                    </div>
                </div>`;
            document.body.insertAdjacentHTML('beforeend', modal);
        }
    </script>
</body>
</html>
